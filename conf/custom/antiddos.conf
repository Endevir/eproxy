# Shared memory for keeping request counters by ip/request. Using 1GB, because we have enough memory
# Btw. It's okay if overflow happens, this means that some request entries will be skipped, that's not critical
lua_shared_dict req_limit 1024m;

# Shared memory for keeping banned users list. Assuming 256MB will be enough
lua_shared_dict ban_list 256m;

# Whitelist. Enter here IP addresses, which should automatically bypass all checks
geo $lua_req_whitelist {
    default          0;
#     93.175.2.105     1; 
    127.0.0.1        1;
#    12.34.56.78/24   1;
}

geo $lua_req_blacklist {
    default          0;
#     93.175.2.105     1; 
}

# Initializing



# Including lua script filtering access info and adding users in ban-list
access_by_lua_file /etc/nginx/custom/lua/antiddos_filter.lua;
